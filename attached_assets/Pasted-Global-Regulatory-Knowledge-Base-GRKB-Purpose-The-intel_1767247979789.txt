Global Regulatory Knowledge Base (GRKB)
Purpose: The intelligence layer that understands regulations
python# File: /home/claude/regulatoryos/core/grkb.py

class GlobalRegulatoryKnowledgeBase:
    """
    Structured regulatory intelligence
    """
    
    def __init__(self):
        self.regulations = self._load_regulations()
        
    def _load_regulations(self):
        """
        Load structured regulatory requirements
        """
        return {
            'EU_MDR': {
                'psur_requirements': {
                    'article': 'Article 86',
                    'frequency': {
                        'class_i': None,
                        'class_iia': 'If requested',
                        'class_iib': 'Annual or upon request',
                        'class_iii': 'Annual or upon request',
                        'class_iii_implant': 'Annual'
                    },
                    'required_sections': [
                        'Device identification',
                        'Surveillance period',
                        'Sales and distribution data',
                        'Complaint data and analysis',
                        'Adverse event summary',
                        'Trend analysis',
                        'Benefit-risk evaluation',
                        'Conclusions'
                    ],
                    'device_grouping': {
                        'guidance': 'MDCG 2022-21',
                        'criteria': [
                            'Same generic device group',
                            'Same intended purpose',
                            'Similar design and technical characteristics',
                            'Same clinical effects'
                        ]
                    }
                },
                'complaint_rate_formula': 'complaints / units_distributed * 100',
                'trend_threshold': '3_sigma',
                'reporting_period': 'Annual unless otherwise specified'
            },
            'UK_MDR': {
                'psur_requirements': {
                    # UK-specific requirements post-Brexit
                    'frequency': 'Annual for Class IIb+',
                    'submission': 'MHRA portal',
                    'divergence_from_eu': [
                        'Separate UKCA marking requirements',
                        'Different submission portal',
                        'UK Responsible Person required'
                    ]
                }
            },
            'FDA_510K': {
                'periodic_reporting': {
                    'medical_device_reporting': {
                        'manufacturer_requirements': '21 CFR 803',
                        'reportable_events': [
                            'Death',
                            'Serious injury',
                            'Malfunction'
                        ],
                        'timelines': {
                            'death_serious_injury': '30 days',
                            'malfunction': '30 days',
                            'five_day_report': 'Public health urgent'
                        }
                    }
                }
            }
        }
        
    def query(self, regulation: str, requirement: str, device_class: str = None):
        """
        Query regulatory requirements
        
        Example:
        grkb.query('EU_MDR', 'psur_requirements', device_class='class_iib')
        
        Returns structured requirements for PSUR for Class IIb device
        """
        try:
            result = self.regulations[regulation][requirement]
            
            if device_class and 'frequency' in result:
                if isinstance(result['frequency'], dict):
                    result['applicable_frequency'] = result['frequency'].get(device_class)
                    
            return result
        except KeyError:
            return None
            
    def get_required_sections(self, regulation: str, document_type: str):
        """
        Get required document sections for compliance
        """
        try:
            return self.regulations[regulation][f'{document_type}_requirements']['required_sections']
        except KeyError:
            return []
            
    def validate_device_grouping(self, devices: list, regulation: str = 'EU_MDR'):
        """
        Validate if devices can be grouped per regulatory guidance
        """
        criteria = self.regulations[regulation]['psur_requirements']['device_grouping']['criteria']
        
        # Logic to evaluate if devices meet grouping criteria
        # For MVP, return structure showing how validation works
        
        return {
            'can_group': True,  # Simplified for MVP
            'criteria_met': criteria,
            'guidance_reference': 'MDCG 2022-21',
            'justification': 'All devices in same generic group with same intended purpose'
        }